高速＆リアルタイムが求められる
今どきコンピュータのフロントエンドにピッタリ
FPGA USBアダプタで広がる可能性
岡村 喜博
Yoshihiro Okamura
最近注目を集める人工知能（AI）や拡張現実（AR）/仮想現実（VR），多機能カメラ（動画），多機能オーディオ/音声信号処理，画像/センサ・データ・フュージョンには，高速計算やリアルタイム応答が求められます．並列処理が自由に実現できるFPGAはそんな用途に便利に使えるデバイスの1つです．ここでは，FPGAをPCのフロントエンド計算機として使う「FPGA USBアダプタ」の可能性を紹介したいと思います．
その1：人工知能（AI）信号処理
　人工知能（AI）などの高速リアルタイム計算に，FPGA専用ハードウェア計算機が使えるかもしれません（図1）．USB接続できれば，PCや小型ラズベリー・パイ（Raspberry Pi）などのホストと組み合わせて使えるので，ずいぶんと便利です．
その2：USB測定器
　FPGAは，データの汎用的な入出力が可能で，リアルタイム信号処理も得意なので，さまざまな測定器を作ることができます（図2）．
　タイミングがクリティカルな信号もクロック単位で正確にスケジュールできるFPGAなら問題が起こりにくく，計測制御に向いています．
　USB接続でホストPCとつなげれば，簡単に専用測定器を作ることができます．
　また，一般的でないインターフェースなどでもFPGAなら専用の回路が用意できます．
その3：ビデオ＆フュージョン
●基本形：USBビデオ・カメラ
　FPGAはリアルタイム画像・映像処理に非常に向いています．FPGA USBアダプタであれば，ホストPCとの接続が簡単で，カメラのフロントエンド信号処理を行わせることが可能です（図3）．
　うまく前処理を行うことができれば，ホストPCを目的とする画像処理に集中させることができます．
●発展形：USBビデオ・カメラ＋センサ
　画像とセンサ・データの組み合わせ（フュージョン）は，これからのキー・テクノロジの1つです．位置データや地図とも組み合わせれば，強力なIoT（Internet of Things）ワールドを実現できる可能性があります（図4）．
　FPGAであれば，カメラとセンサの両方を自由につなぐことが可能ですし，USBの異なる転送方式を組み合わせて1つのFPGAに実装することもできます．
　ホスト側でAI処理などをする場合のインターフェースなどとしても活用できます．
その4：オーディオ＆音声
　FPGAは，映像や音声，無線などのリアルタイムなストリーム・データの信号処理に向いています．前述のビデオ用途だけでなく，オーディオや音声の信号処理アダプタとして使うこともできます．ここで幾つか可能性を紹介しておきます．
　本特集では，FPGA USBアダプタの実験例として，FPGAオーディオを紹介します．
●その4-1：ハイレゾ対応USBオーディオ再生器
　音楽CDのデータ・フォーマットは，サンプリング周波数44.1kHz，分解能16ビットです．最近のダウンロード音楽データは，データ・サイズの心配がなくなり，CDを超えるサンプリング周波数96kHz以上，分解能24ビット以上のデータも出てきています．「ハイレゾ」音源といいます．FPGA USBアダプタを使えば，ハイレゾ音源をオーディオ用D-Aコンバータ（DAC）に渡して再生する，ディジタル的に高音質なPCオーディオを実現できます（図5）．
　入出力ともシリアル・インターフェースを使用するのでハードウェアの製作は非常にシンプルにできます（例えば，電源とGNDを除けばFPGAには最小で6本の信号を接続するだけで構成することも可能）．
　詳細は後述しますが，高精度な発振器を使ってオーディオ再生が可能なUSB同期方式に対応しているので，高音質でオーディオ・データを再生することが可能です．
●その4-2：ハイレゾ対応USB録音器
　マルチチャネル・高精細な音を録音できます（図6）．
　また，多くのマイコンではディジタル（シリコン）マイクからのPDM信号を直接入力できないのですが，FPGAなら直接受け取ることが可能です．ディジタル・マイクが使用できるとアナログ回路不要で回路構成が簡単です．低消費電力に構成することも可能です．
●その4-3：ハイレゾ対応録音＆再生器
　図7は，前述のUSBオーディオDACとUSBオーディオADCを組み合わせた構成で，USB オーディオCODECともいいます．オーディオの入力と出力は独立して構成できるので基本的に前述の全ての特徴を併せ持つことができます．
●その4-4：いろいろなオーディオ入出力に対応可能
　オーディオでは，アナログ入出力以外にもさまざまなディジタル・オーディオ・データ入出力がありますが，FPGAであればいろいろな組み合わせに対応可能です（図8）．
その5：その他
●その5-1：センサをいっぱいつなぐ
　最近のディジタルI2C接続センサ・モジュールを1つつなぐだけならマイコンで十分です．しかしFPGAなら，大量のモジュールを接続しても確実に処理することが可能です（図9）．
　データが大量であってもデータの前処理回路を追加することでホスト側の負荷や転送量を削減することが可能です．
●その5-2：My専用回路をPCにシリアル接続
　既にMy FPGA回路がある場合に，USB通信機能を追加できるのも便利です（図10）．
　HIDクラスを使用すればホストPC側に特別なドライバを用意せずに使用することも可能です．ドライバに依存する既存のシリアル・デバイスの置き換えに使用することも可能です．
おかむら・よしひろ
